import{p as e,q as a,r as t,u as o,A as s,n as r}from"./element-plus-D5xJ9DPN.js";import{B as l}from"./BREAK-LibRWxXm.js";import{b as n}from"./index-CceU3vjc.js";import{a as i,u}from"./vue-router-BEXBg7Fd.js";import{d as m,b as c,w as y,t as d,J as k,A as v,D as f,_ as p,Q as B,O as K,ab as h,u as A,B as b,ac as j,U as T,E as O,M as g,c as I,r as E}from"./vue-CxVCOtPj.js";import"./BREAK-Risks-tud6J5-y.js";import"./BREAK-utils-dekRhMIS.js";import"./BREAK-Avoidances-CkuVuIR8.js";import"./BREAK-AttackTools-B7v_fDTB.js";import"./BREAK-ThreatActors-DscyYbs6.js";import"./vue-i18n-U3rzzJhO.js";import"./relation-graph-CUtAT3hc.js";const R={style:{"text-align":"center"}},_=["title"],V={style:{"text-align":"center",margin:"10px"}};var w=(e=>(e.risks="risks",e.avoidances="avoidances",e.attackTools="attackTools",e.threatActors="threatActors",e))(w||{}),x=(e=>(e.risks="risks",e.avoidances="avoidances",e.attackTools="attack-tools",e.threatActors="threat-actors",e))(x||{}),S=(e=>(e.risks="风险",e.avoidances="规避手段",e.attackTools="攻击工具",e.threatActors="威胁行为者",e))(S||{});const J=m({__name:"HomeView",setup(m){const J=i(),N=u(),C=c(J.params.type||""),U=c(J.params.key||""),D=I(()=>{if(""===C.value)return{};const e=l[C.value];return e||{}}),$=I(()=>{if(!D.value)return{};if(""===U.value)return{};const e=D.value[U.value];return void 0===e?{}:e}),q=E({risks:{avoidances:{title:"规避手段",type:"one2many",fromBreakKey:"risks",fromBreakItemKey:"avoidances",toBreakKey:"avoidances",val:[],data:[],jsons:[]},attackTools:{title:"攻击工具",type:"many2one",fromBreakKey:"attackTools",fromBreakItemKey:"couseRisks",toBreakKey:"risks",val:[],data:[]},threatActors:{title:"威胁行为者",type:"many2one",fromBreakKey:"threatActors",fromBreakItemKey:"couseRisks",toBreakKey:"risks",val:[],data:[]}},avoidances:{risks:{title:"规避风险",type:"many2one",fromBreakKey:"risks",fromBreakItemKey:"avoidances",toBreakKey:"avoidances",val:[],data:[]},attackTools:{title:"攻击工具",type:"many2one",fromBreakKey:"attackTools",fromBreakItemKey:"avoidances",toBreakKey:"avoidances",val:[],data:[]}},attackTools:{avoidances:{title:"规避手段",type:"one2many",fromBreakKey:"attackTools",fromBreakItemKey:"avoidances",toBreakKey:"avoidances",val:[],data:[]},couseRisks:{title:"造成风险",type:"one2many",fromBreakKey:"attackTools",fromBreakItemKey:"couseRisks",toBreakKey:"risks",val:[],data:[]},buildAttackTools:{title:"制造攻击工具",type:"many2one",fromBreakKey:"threatActors",fromBreakItemKey:"buildAttackTools",toBreakKey:"attackTools",val:[],data:[]},useAttackTools:{title:"使用攻击工具",type:"many2one",fromBreakKey:"threatActors",fromBreakItemKey:"useAttackTools",toBreakKey:"attackTools",val:[],data:[]}},threatActors:{couseRisks:{title:"造成风险",type:"one2many",fromBreakKey:"threatActors",fromBreakItemKey:"couseRisks",toBreakKey:"risks",val:[],data:[]},buildAttackTools:{title:"制造攻击工具",type:"one2many",fromBreakKey:"threatActors",fromBreakItemKey:"buildAttackTools",toBreakKey:"attackTools",val:[],data:[]},useAttackTools:{title:"使用攻击工具",type:"one2many",fromBreakKey:"threatActors",fromBreakItemKey:"useAttackTools",toBreakKey:"attackTools",val:[],data:[]}}}),z=e=>{const a=[];return Object.entries(l[e]).forEach(([e,t])=>{a.push({key:e,label:e+": "+t.title,description:t.description,disabled:!1})}),a};Object.values(q).forEach(e=>{Object.values(e).forEach(e=>{"one2many"===e.type?e.data=z(e.toBreakKey):"many2one"===e.type&&(e.data=z(e.fromBreakKey))})});const L=()=>{const e=q[C.value];Object.values(e).forEach(e=>{const a=[],t=l[e.fromBreakKey];if("one2many"===e.type){const o=t[U.value];o&&a.push(...o[e.fromBreakItemKey])}else"many2one"===e.type&&Object.entries(t).forEach(([t,o])=>{o[e.fromBreakItemKey].includes(U.value)&&a.push(t)});e.val=a})};C.value&&U.value&&L(),y([C,U],()=>{C.value&&U.value&&(N.push({name:"editorWithParams",params:{type:C.value,key:U.value}}),L())});let F=!0;const H=(e,a)=>{F=!1;const t={path:e,json:a};n.post("http://127.0.0.1:3000/",t).then(e=>{F=!0,console.log(e.data)}).catch(e=>{F=!1,alert(e)})},M=e=>{F||(e.preventDefault(),e.returnValue="")};d(()=>{window.addEventListener("beforeunload",M)}),k(()=>{window.removeEventListener("beforeunload",M)});const P=()=>new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Chongqing"}).format(new Date);return(n,i)=>{const u=t,m=a,c=e,y=o,d=s,k=r;return v(),f(K,null,[p(y,{gutter:20},{default:B(()=>[p(c,{md:4},{default:B(()=>[p(m,{modelValue:C.value,"onUpdate:modelValue":i[0]||(i[0]=e=>C.value=e),onChange:i[1]||(i[1]=e=>U.value="")},{default:B(()=>[(v(),f(K,null,h(w,e=>p(u,{key:e,label:S[e],value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),p(c,{md:4},{default:B(()=>[p(m,{modelValue:U.value,"onUpdate:modelValue":i[2]||(i[2]=e=>U.value=e)},{default:B(()=>[(v(!0),f(K,null,h(A(l)[C.value],(e,a)=>(v(),b(u,{key:a,label:a+":"+e.title,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),p(c,{md:4},{default:B(()=>[j(" 最近更新： "+T($.value?$.value.updated:""),1)]),_:1})]),_:1}),C.value&&U.value?(v(),b(y,{key:0,gutter:20,style:{padding:"10px"}},{default:B(()=>[(v(!0),f(K,null,h(Object.entries(q[C.value]),([e,a])=>(v(),b(c,{key:C.value+e,md:12},{default:B(()=>[O("h3",R,T($.value?$.value.title:"")+" "+T(S[C.value])+"  -  "+T("one2many"==a.type?S[a.toBreakKey]:S[a.fromBreakKey])+" （"+T(a.title)+"） ",1),p(d,{modelValue:a.val,"onUpdate:modelValue":e=>a.val=e,data:a.data},{default:B(({option:e})=>[O("span",{title:e.description},T(e.label),9,_)]),_:1},8,["modelValue","onUpdate:modelValue","data"]),O("div",V,[p(k,{type:"primary",size:"default",onClick:e=>(e=>{if("one2many"===e.type){const a=JSON.stringify($.value),t=$.value;if(t[e.fromBreakItemKey]=[...new Set(e.val)],t[e.fromBreakItemKey].sort(),a===JSON.stringify(t))return;t.updated=P();const o={[U.value]:t};let s=U.value;U.value.indexOf("-")>-1&&(s=U.value.split("-")[0]),Object.keys(D.value).forEach(e=>{e!==U.value&&e.indexOf(s)>-1&&(o[e]=D.value[e])});const r=Object.keys(o).sort().reduce((e,a)=>(e[a]=o[a],e),{}),l=JSON.stringify(r,null,2),n=`../BREAK/${x[C.value]}/${s}.json`;H(n,l)}else"many2one"===e.type&&Object.entries(D.value).forEach(([a,t])=>{const o=JSON.stringify(t),s=t,r=s[e.fromBreakItemKey];if(e.val.includes(a))r.includes(U.value)||r.push(U.value),s[e.fromBreakItemKey]=[...new Set(r)],s[e.fromBreakItemKey].sort();else{const a=r.indexOf(U.value);if(a<=-1)return;r.splice(a,1),s[e.fromBreakItemKey]=[...new Set(r)],s[e.fromBreakItemKey].sort()}if(o===JSON.stringify(s))return;s.updated=P();const l={[a]:s};let n=a;a.indexOf("-")>-1&&(n=a.split("-")[0]),Object.keys(D.value).forEach(e=>{e!==a&&e.indexOf(n)>-1&&(l[e]=D.value[e])});const i=Object.keys(l).sort().reduce((e,a)=>(e[a]=l[a],e),{}),u=JSON.stringify(i,null,2),m=`../BREAK/${x[e.fromBreakKey]}/${n}.json`;H(m,u)})})(a)},{default:B(()=>[...i[3]||(i[3]=[j("提交修改",-1)])]),_:1},8,["onClick"])])]),_:2},1024))),128))]),_:1})):g("",!0)],64)}}});export{J as default};
